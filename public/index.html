<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Cagnotte du Caf√© ‚òï</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Styles custom pour votre design original */
        .participant-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            color: white;
            padding: 16px;
            margin: 8px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .emoji-large {
            font-size: 2rem;
        }
        
        .counter-individual {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }
        
        .negative-contrib {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }
        
        .positive-contrib {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
        }
        
        .preparation-counter {
            display: inline-block;
            background: #ffd43b;
            color: #333;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 8px;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="container mx-auto p-4 max-w-6xl">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">‚òï La Cagnotte du Caf√©</h1>
            <p class="text-gray-600">G√©rez votre caf√© d'√©quipe facilement</p>
        </header>

        <!-- Solde Principal -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 text-center">
            <h2 class="text-xl font-semibold text-gray-700 mb-2">Solde Actuel de la Cagnotte</h2>
            <div id="solde" class="text-5xl font-bold text-green-600">0.00 ‚Ç¨</div>
        </div>

        <div class="grid lg:grid-cols-3 gap-6">
            
            <!-- Participants Section -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">üë• Participants</h3>
                    
                    <!-- Ajouter un participant -->
                    <div class="bg-gray-50 rounded-lg p-4 mb-4">
                        <h4 class="font-semibold mb-3">Ajouter un Participant</h4>
                        <div class="flex gap-3">
                            <input type="text" id="nomParticipant" placeholder="Nom du participant" 
                                   class="flex-1 p-3 border border-gray-300 rounded-lg">
                            <input type="number" id="contributionInitiale" placeholder="Contribution (‚Ç¨)" step="0.01" 
                                   class="w-32 p-3 border border-gray-300 rounded-lg">
                            <button onclick="ajouterParticipant()" 
                                    class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                ‚ûï Ajouter
                            </button>
                        </div>
                    </div>
                    
                    <!-- Liste des participants -->
                    <div id="listeParticipants">
                        <p class="text-gray-500 text-center py-8">Aucun participant pour le moment.</p>
                    </div>
                </div>

                <!-- Journal des Caf√©s Pr√©par√©s -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">‚òï Journal des Caf√©s Pr√©par√©s</h3>
                    <div class="mb-4">
                        <select id="preparateurSelect" class="w-full p-3 border border-gray-300 rounded-lg mb-3">
                            <option value="">Qui a pr√©par√© le caf√© ?</option>
                        </select>
                        <button onclick="ajouterPreparation()" 
                                class="w-full py-3 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600">
                            ‚òï Marquer comme pr√©par√©
                        </button>
                    </div>
                    
                    <!-- Pr√©parations par jour -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-semibold mb-3">Pr√©parations par Jour</h4>
                        <div id="preparationsJour">
                            <p class="text-gray-500">Aucune pr√©paration pour le moment.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar droite -->
            <div class="space-y-6">
                
                <!-- Enregistrer une D√©pense -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üí∞ Enregistrer une D√©pense</h3>
                    <div class="space-y-3">
                        <input type="text" id="descriptionDepense" placeholder="Description (ex: Caf√©, Lait...)" 
                               class="w-full p-3 border border-gray-300 rounded-lg">
                        <input type="number" id="montantDepense" placeholder="Montant (‚Ç¨)" step="0.01" 
                               class="w-full p-3 border border-gray-300 rounded-lg">
                        <button onclick="ajouterDepense()" 
                                class="w-full py-3 bg-red-500 text-white rounded-lg hover:bg-red-600">
                            üí∏ Enregistrer
                        </button>
                    </div>
                </div>

                <!-- Stock de Fournitures -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üì¶ Stock de Fournitures</h3>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span>‚òï Sacs de caf√©</span>
                            <div class="flex items-center gap-2">
                                <button onclick="modifierStock('cafe', -1)" class="px-3 py-1 bg-red-500 text-white rounded">-</button>
                                <span id="stockCafe" class="font-bold min-w-[2rem] text-center">0</span>
                                <button onclick="modifierStock('cafe', 1)" class="px-3 py-1 bg-green-500 text-white rounded">+</button>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span>üîç Bo√Ætes de filtres</span>
                            <div class="flex items-center gap-2">
                                <button onclick="modifierStock('filtres', -1)" class="px-3 py-1 bg-red-500 text-white rounded">-</button>
                                <span id="stockFiltres" class="font-bold min-w-[2rem] text-center">0</span>
                                <button onclick="modifierStock('filtres', 1)" class="px-3 py-1 bg-green-500 text-white rounded">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Historique -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üìú Historique des Transactions</h3>
                    <div id="historiqueTransactions" class="max-h-64 overflow-y-auto">
                        <p class="text-gray-500">Aucune transaction pour le moment.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === STOCKAGE LOCAL ===
        function sauvegarder(cle, donnees) {
            localStorage.setItem(cle, JSON.stringify(donnees));
        }

        function charger(cle) {
            const data = localStorage.getItem(cle);
            return data ? JSON.parse(data) : [];
        }

        // === DONN√âES ===
        let participants = charger('participants') || [];
        let transactions = charger('transactions') || [];
        let preparations = charger('preparations') || [];
        let stock = charger('stock') || { cafe: 0, filtres: 0 };

        // === FONCTIONS PARTICIPANTS ===
        function ajouterParticipant() {
            const nom = document.getElementById('nomParticipant').value.trim();
            const contribution = parseFloat(document.getElementById('contributionInitiale').value) || 0;
            
            if (nom === '') {
                alert('‚ùå Veuillez entrer un nom');
                return;
            }
            
            // V√©rifier si le participant existe d√©j√†
            if (participants.find(p => p.nom.toLowerCase() === nom.toLowerCase())) {
                alert('‚ùå Ce participant existe d√©j√† !');
                return;
            }
            
            const participant = {
                id: Date.now(),
                nom: nom,
                contributions: contribution > 0 ? [{ montant: contribution, date: new Date().toISOString() }] : [],
                preparationsCompte: 0,
                totalContribue: contribution
            };
            
            participants.push(participant);
            sauvegarder('participants', participants);
            
            if (contribution > 0) {
                ajouterTransaction(`üí∞ Contribution de ${nom}`, contribution, 'contribution', nom);
            }
            
            document.getElementById('nomParticipant').value = '';
            document.getElementById('contributionInitiale').value = '';
            
            mettreAJourInterface();
            alert(`‚úÖ ${nom} ajout√© avec succ√®s !`);
        }

        function ajouterContributionParticipant(participantId, montant) {
            const participant = participants.find(p => p.id === participantId);
            if (!participant) return;
            
            const contribution = {
                montant: parseFloat(montant),
                date: new Date().toISOString()
            };
            
            participant.contributions.push(contribution);
            participant.totalContribue += contribution.montant;
            
            sauvegarder('participants', participants);
            ajouterTransaction(`üí∞ Contribution de ${participant.nom}`, contribution.montant, 'contribution', participant.nom);
            mettreAJourInterface();
        }

        function retirerContributionParticipant(participantId, montant) {
            const participant = participants.find(p => p.id === participantId);
            if (!participant) return;
            
            const retrait = {
                montant: -parseFloat(montant),
                date: new Date().toISOString()
            };
            
            participant.contributions.push(retrait);
            participant.totalContribue += retrait.montant;
            
            sauvegarder('participants', participants);
            ajouterTransaction(`‚ùå Retrait de ${participant.nom}`, Math.abs(retrait.montant), 'retrait', participant.nom);
            mettreAJourInterface();
        }

        // === FONCTIONS D√âPENSES ===
        function ajouterDepense() {
            const description = document.getElementById('descriptionDepense').value.trim();
            const montant = parseFloat(document.getElementById('montantDepense').value) || 0;
            
            if (description === '' || montant <= 0) {
                alert('‚ùå Veuillez remplir tous les champs correctement');
                return;
            }
            
            ajouterTransaction(description, montant, 'depense');
            
            document.getElementById('descriptionDepense').value = '';
            document.getElementById('montantDepense').value = '';
            
            mettreAJourInterface();
            alert('‚úÖ D√©pense enregistr√©e !');
        }

        // === FONCTIONS PR√âPARATIONS ===
        function ajouterPreparation() {
            const selecteur = document.getElementById('preparateurSelect');
            const participantNom = selecteur.value;
            
            if (!participantNom) {
                alert('‚ùå Veuillez s√©lectionner qui a pr√©par√© le caf√©');
                return;
            }
            
            const participant = participants.find(p => p.nom === participantNom);
            if (participant) {
                participant.preparationsCompte++;
                sauvegarder('participants', participants);
            }
            
            const preparation = {
                id: Date.now(),
                preparateur: participantNom,
                date: new Date().toLocaleDateString('fr-FR'),
                heure: new Date().toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})
            };
            
            preparations.push(preparation);
            sauvegarder('preparations', preparations);
            
            selecteur.value = '';
            mettreAJourInterface();
            alert(`‚òï ${participantNom} a pr√©par√© un caf√© !`);
        }

        // === FONCTIONS STOCK ===
        function modifierStock(type, quantite) {
            stock[type] = Math.max(0, (stock[type] || 0) + quantite);
            sauvegarder('stock', stock);
            mettreAJourInterface();
        }

        // === FONCTIONS TRANSACTIONS ===
        function ajouterTransaction(description, montant, type, participant = null) {
            const transaction = {
                id: Date.now(),
                description: description,
                montant: montant,
                type: type,
                participant: participant,
                date: new Date().toLocaleDateString('fr-FR'),
                heure: new Date().toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'})
            };
            
            transactions.push(transaction);
            sauvegarder('transactions', transactions);
        }

        // === AFFICHAGE ===
        function calculerSolde() {
            return transactions.reduce((total, transaction) => {
                switch(transaction.type) {
                    case 'contribution':
                        return total + transaction.montant;
                    case 'depense':
                    case 'retrait':
                        return total - transaction.montant;
                    default:
                        return total;
                }
            }, 0);
        }

        function mettreAJourInterface() {
            // Solde
            const solde = calculerSolde();
            const soldeElement = document.getElementById('solde');
            if (soldeElement) {
                soldeElement.textContent = `${solde.toFixed(2)} ‚Ç¨`;
                soldeElement.className = `text-5xl font-bold ${solde >= 0 ? 'text-green-600' : 'text-red-600'}`;
            }
            
            afficherParticipants();
            afficherHistoriqueTransactions();
            afficherPreparations();
            afficherStock();
            mettreAJourSelecteurPreparateur();
        }

        function afficherParticipants() {
            const container = document.getElementById('listeParticipants');
            if (!container) return;
            
            if (participants.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Aucun participant pour le moment.</p>';
                return;
            }
            
            container.innerHTML = participants.map(p => `
                <div class="participant-card ${p.totalContribue >= 0 ? 'positive-contrib' : 'negative-contrib'}">
                    <div class="flex justify-between items-center">
                        <div>
                            <h4 class="font-bold text-lg">${p.nom}</h4>
                            <p class="text-sm opacity-90">
                                Total: ${p.totalContribue.toFixed(2)}‚Ç¨
                                <span class="preparation-counter">‚òï ${p.preparationsCompte}</span>
                            </p>
                        </div>
                        <div class="text-3xl">
                            ${p.totalContribue >= 0 ? 'üòä' : 'üò∞'}
                        </div>
                    </div>
                    
                    <div class="mt-3 flex gap-2">
                        <input type="number" id="contrib-${p.id}" placeholder="Montant" step="0.01" 
                               class="flex-1 p-2 rounded bg-white/20 text-white placeholder-white/70">
                        <button onclick="ajouterContributionParticipant(${p.id}, document.getElementById('contrib-${p.id}').value); document.getElementById('contrib-${p.id}').value=''" 
                                class="px-4 py-2 bg-green-500/80 rounded text-white hover:bg-green-600">
                            ‚ûï
                        </button>
                        <button onclick="retirerContributionParticipant(${p.id}, document.getElementById('contrib-${p.id}').value); document.getElementById('contrib-${p.id}').value=''" 
                                class="px-4 py-2 bg-red-500/80 rounded text-white hover:bg-red-600">
                            ‚ûñ
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function afficherHistoriqueTransactions() {
            const container = document.getElementById('historiqueTransactions');
            if (!container) return;
            
            if (transactions.length === 0) {
                container.innerHTML = '<p class="text-gray-500">Aucune transaction pour le moment.</p>';
                return;
            }
            
            const transactionsRecentes = transactions.slice(-10).reverse();
            
            container.innerHTML = transactionsRecentes.map(t => {
                const typeIcon = {
                    'contribution': 'üí∞',
                    'depense': 'üí∏',
                    'retrait': '‚ùå'
                }[t.type] || 'üí∏';
                
                const typeColor = {
                    'contribution': 'text-green-600',
                    'depense': 'text-red-600',
                    'retrait': 'text-orange-600'
                }[t.type] || 'text-red-600';
                
                return `
                    <div class="border-b border-gray-200 pb-2 mb-2">
                        <div class="flex justify-between items-center">
                            <div class="flex-1">
                                <span class="text-lg">${typeIcon}</span>
                                <span class="font-medium">${t.description}</span>
                                ${t.participant ? `<br><small class="text-gray-500">par ${t.participant}</small>` : ''}
                            </div>
                            <span class="font-bold ${typeColor}">
                                ${t.type === 'contribution' ? '+' : '-'}${t.montant.toFixed(2)}‚Ç¨
                            </span>
                        </div>
                        <small class="text-gray-500">${t.date} √† ${t.heure}</small>
                    </div>
                `;
            }).join('');
        }

        function afficherPreparations() {
            const container = document.getElementById('preparationsJour');
            if (!container) return;
            
            if (preparations.length === 0) {
                container.innerHTML = '<p class="text-gray-500">Aucune pr√©paration pour le moment.</p>';
                return;
            }
            
            // Grouper par jour
            const preparationsParJour = {};
            preparations.forEach(prep => {
                if (!preparationsParJour[prep.date]) {
                    preparationsParJour[prep.date] = [];
                }
                preparationsParJour[prep.date].push(prep);
            });
            
            const jours = Object.keys(preparationsParJour).sort().reverse().slice(0, 5);
            
            container.innerHTML = jours.map(jour => {
                const prepsJour = preparationsParJour[jour];
                return `
                    <div class="mb-3">
                        <h5 class="font-semibold text-gray-800">${jour} (${prepsJour.length} caf√©${prepsJour.length > 1 ? 's' : ''})</h5>
                        <div class="text-sm text-gray-600">
                            ${prepsJour.slice(-3).map(p => `${p.heure} - ${p.preparateur}`).join(' ‚Ä¢ ')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function afficherStock() {
            const cafeElement = document.getElementById('stockCafe');
            const filtresElement = document.getElementById('stockFiltres');
            
            if (cafeElement) cafeElement.textContent = stock.cafe || 0;
            if (filtresElement) filtresElement.textContent = stock.filtres || 0;
        }

        function mettreAJourSelecteurPreparateur() {
            const selecteur = document.getElementById('preparateurSelect');
            if (!selecteur) return;
            
            selecteur.innerHTML = '<option value="">Qui a pr√©par√© le caf√© ?</option>' +
                participants.map(p => `<option value="${p.nom}">${p.nom}</option>`).join('');
        }

        // === INITIALISATION ===
        document.addEventListener('DOMContentLoaded', function() {
            mettreAJourInterface();
            console.log('‚òï Cagnotte du caf√© charg√©e !');
        });
    </script>
</body>
</html>
